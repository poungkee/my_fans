# FANS 크롤링 서비스 개발 과정 문서

## 문제 발생 배경

### 1. 초기 문제점들
- **백엔드 통합 구조의 한계**: 크롤링이 백엔드 메인 서비스와 통합되어 있어서 재시작 시간이 오래 걸렸음
- **뉴스 품질 문제**: 모든 언론사가 "연합뉴스"로 표시되고 기자 정보가 "없음"으로 나타남
- **낮은 크롤링 효율**: 24개 예상 수집량 중 4개만 수집되는 16.7% 성공률
- **데이터베이스 저장 실패**: 수집된 뉴스조차 타겟 필터링으로 인해 저장되지 않음

### 2. 근본 원인 분석
- **Naver API 의존성**: 네이버 검색 API는 주로 지역/소규모 언론사를 반환함
- **타겟 언론사 필터**: 14개 주요 언론사만 허용하는 필터가 대부분 뉴스를 차단
- **서비스 결합도**: 크롤링과 메인 백엔드의 높은 결합도로 개발 속도 저하

## 해결 과정

### 1단계: 서비스 분리 결정
**배경**: "백엔드 재시작하는데 시간 좀 걸리지? 만약에 이거 분리시키면 재시작시키는데 좀 빨라지냐?"
- 크롤링 서비스를 독립적인 마이크로서비스로 분리 결정
- `backend/crawler` 디렉토리로 분리
- 포트 4001에서 독립 실행

### 2단계: 기본 구조 안정화
**문제**: 엔티티 의존성 오류들 발생
- NewsKeyword, BiasAnalysis 등 불필요한 엔티티 참조 제거
- Source, Category만 남겨서 최소한의 관계 유지
- 포트 충돌 해결 (PORT → CRAWLER_PORT 변경)

### 3단계: 기자 이름 추출 개선
**문제**: 기자 이름이 "없음"으로 표시
- 이메일 주소 제거 로직 추가
- "기자", "특파원" 등 직책명 제거
- 괄호, 대괄호 내용 정리

### 4단계: 데이터 수집 문제 분석
**발견**: 크롤링은 정상 작동하나 타겟 필터링이 과도함
- 디버그 로그 추가로 문제점 파악
- Naver API는 1개씩만 반환하도록 설정되어 있었음
- YTN 뉴스만 타겟 리스트에 포함되어 저장됨

### 5단계: RSS 피드 도입 검토
**배경**: "RSS 주소 가지고오면 그거는 수정해야될께 많니?"
- 5개 주요 언론사 RSS 피드 테스트 완료
- 경향신문, 동아일보, 한겨레, 조선일보, 국민일보 모두 사용 가능
- 기존 Naver API보다 안정적이고 풍부한 데이터 제공

### 6단계: 이중 크롤링 시스템 구현
**최종 결정**: API와 RSS 두 크롤러를 독립적으로 운영
- `newsCrawlerService.ts`: 기존 Naver API 크롤링
- `rssCrawlerService.ts`: 새로운 RSS 크롤링
- 세 가지 엔드포인트 제공:
  - `/crawl/api/start`: API만 크롤링
  - `/crawl/rss/start`: RSS만 크롤링
  - `/crawl/all/start`: 통합 크롤링

## 주요 의사결정

### 1. 서비스 분리 vs 통합 유지
**결정**: 분리
**이유**: 개발 속도 향상, 독립적 확장 가능

### 2. RSS vs API 선택
**결정**: 둘 다 유지
**이유**: RSS로 품질 확보, API로 다양성 확보

### 3. 필터링 제거 vs 개선
**결정**: 임시 제거 후 RSS로 대체
**이유**: 타겟 언론사 RSS 직접 수집으로 필터 불필요

### 4. 단일 크롤러 vs 이중 크롤러
**결정**: 이중 크롤러
**이유**: 각각 독립적 운영으로 안정성 확보

## 현재 상태

### 구현 완료
- ✅ 독립 크롤링 서비스 (포트 4001)
- ✅ RSS 크롤링 시스템
- ✅ API/RSS/통합 크롤링 엔드포인트
- ✅ 기자 이름 추출 개선
- ✅ 5개 주요 언론사 RSS 연동

### 예상 효과
- **수집량 증가**: RSS로 각 언론사당 10개씩 = 50개 뉴스
- **품질 개선**: 직접 RSS에서 정확한 언론사/기자명 획득
- **개발 속도**: 독립 서비스로 빠른 개발/테스트
- **안정성**: API 장애시 RSS로 백업, 그 반대도 가능

### 남은 과제
- RSS 크롤러 실제 테스트
- 저장 개수 기준 크롤링 로직
- Docker 컨테이너화
- 다중 인스턴스 확장

## 학습 포인트

1. **문제의 근본 원인 파악**: 단순히 기능 추가가 아니라 구조적 문제였음
2. **점진적 개선**: 한 번에 모든 걸 바꾸지 않고 단계별 접근
3. **대안 탐색**: Naver API 한계 발견 후 RSS 대안 모색
4. **독립성의 가치**: 서비스 분리로 개발 효율성 크게 향상
5. **이중화의 중요성**: 하나의 소스에만 의존하지 않는 백업 시스템