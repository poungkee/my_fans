# FANS Project: AWS 클라우드 아키텍처 최종 설계 문서

**문서 버전**: 2.1 (Final)
**작성일**: 2025년 9월 26일

## 1. 개요 및 설계 원칙

본 문서는 AI 기반 뉴스 큐레이션 서비스 **'FANS (Fast AI News Service)'**를 AWS 클라우드 환경으로 마이그레이션하기 위한 최종 아키텍처 설계안을 정의합니다.

본 아키텍처는 AWS의 모범 사례(Well-Architected Framework)를 기반으로 운영 효율성, 보안, 안정성, 성능 효율성이라는 4가지 핵심 원칙을 기준으로 설계되었습니다. 관리형 서비스(Managed Service)를 적극 활용하여 인프라 관리 부담을 최소화하고, 다중 가용 영역(Multi-AZ) 설계를 통해 안정성을 확보하며, VPC와 보안 그룹을 통해 데이터를 안전하게 보호하는 것을 목표로 합니다.

## 2. 전체 시스템 아키텍처

```
                            ┌─────────────────┐
                            │   CloudFront    │
                            │  (CDN + WAF)    │
                            └──────┬──────────┘
                                   │
                    ┌──────────────┴──────────────┐
                    │                             │
            ┌───────▼────────┐         ┌──────────▼─────────┐
            │      S3        │         │   Application      │
            │  (Frontend)    │         │  Load Balancer     │
            │   Static Web   │         │     (ALB)          │
            └────────────────┘         └──────────┬─────────┘
                                                  │
                              ┌───────────────────┼───────────────────┐
                              │                   │                   │
                    ┌─────────▼───────────────────▼───────────────────▼─────────┐
                    │                 ECS Fargate Cluster                      │
                    │                                                          │
                    │  ┌─────────────┐  ┌─────────────┐  ┌─────────────┐     │
                    │  │  Main API   │  │ RSS Crawler │  │ API Crawler │     │
                    │  └─────────────┘  └─────────────┘  └─────────────┘     │
                    │                                                          │
                    │  ┌─────────────┐  ┌─────────────┐  ┌─────────────┐     │
                    │  │Summarize AI │  │Recommend AI │  │Bias-Anal AI │     │
                    │  └─────────────┘  └─────────────┘  └─────────────┘     │
                    └──────────────────────┬───────────────────────────────────┘
                                           │
                    ┌──────────────────────┼───────────────────────────────────┐
                    │                      │                                   │
            ┌───────▼────────┐    ┌────────▼────────┐       ┌──────────▼──────────┐
            │  ElastiCache   │    │   RDS PostgreSQL │       │    CloudWatch       │
            │   (Redis)      │    │   (Multi-AZ)    │       │   Logs & Metrics    │
            └────────────────┘    └─────────────────┘       └─────────────────────┘
```

### 서비스 흐름 상세

1. **사용자 접속**: 사용자가 도메인으로 접속하면 Amazon Route 53가 요청을 받아 Amazon CloudFront로 안내합니다.

2. **프론트엔드 제공**: CloudFront는 전 세계 엣지 로케이션에 캐싱된 React 정적 파일(원본은 S3에 저장)을 사용자에게 신속하게 전송합니다. 이 과정에서 AWS WAF(웹 방화벽)가 악의적인 웹 트래픽을 필터링합니다.

3. **API 요청**: 프론트엔드에서 발생하는 API 요청은 **Application Load Balancer (ALB)**로 전달됩니다. ALB는 HTTPS 트래픽을 복호화(SSL Termination)하여 내부망으로 안전하게 전달합니다.

4. **애플리케이션 로직**: ALB는 URL 경로에 따라 요청을 적절한 Fargate 서비스로 라우팅합니다. 예를 들어, `/api/news`는 Main API로, `/ai/summarize`는 Summarize AI 서비스로 전달됩니다. 모든 Fargate 서비스는 외부에서 직접 접근할 수 없는 Private Subnet에서 안전하게 실행됩니다.

5. **데이터 처리 및 내부 작업**: 각 서비스는 **Amazon RDS (PostgreSQL)**와 **Amazon ElastiCache (Redis)**에서 데이터를 처리합니다. RSS/API Crawler는 스케줄러(EventBridge)에 의해 주기적으로 실행되며, NAT Gateway를 통해 외부 뉴스 API에 접근하여 데이터를 수집합니다.

6. **모니터링**: 모든 서비스의 로그와 성능 지표는 Amazon CloudWatch로 중앙 집중화되어 실시간 모니터링 및 알람 설정에 사용됩니다.

## 3. 네트워크 상세 설계

```
┌─────────────────────────────────────────────────────────────────────┐
│                          VPC (10.10.0.0/16)                         │
│   ┌─────────────────────────────────────────────────────────────┐   │
│   │                    Public Subnets (외부망)                   │   │
│   │  ┌─────────────┐      ┌─────────────┐    ┌─────────────┐   │   │
│   │  │     ALB     │      │   NAT GW    │    │ Bastion Host│   │   │
│   │  └─────────────┘      └─────────────┘    └─────────────┘   │   │
│   └─────────────────────────────────────────────────────────────┘   │
│   ┌─────────────────────────────────────────────────────────────┐   │
│   │                   Private Subnets (내부망)                   │   │
│   │  ┌─────────────┐      ┌─────────────┐    ┌─────────────┐   │   │
│   │  │  ECS Tasks  │      │    RDS      │    │ ElastiCache │   │   │
│   │  └─────────────┘      └─────────────┘    └─────────────┘   │   │
│   └─────────────────────────────────────────────────────────────┘   │
└─────────────────────────────────────────────────────────────────────┘
```

- **VPC**: 10.10.0.0/16 대역의 논리적으로 격리된 단일 가상 네트워크를 사용합니다.
- **Public Subnet**: 인터넷과 직접 통신하는 ALB와 NAT Gateway를 배치합니다. Internet Gateway에 연결되어 외부 인터넷과 양방향 통신이 가능합니다.
- **Private Subnet**: 핵심 애플리케이션(ECS Fargate), 데이터베이스(RDS), 캐시(ElastiCache)를 배치하여 외부로부터의 직접적인 접근을 원천 차단합니다. Private Subnet의 아웃바운드 인터넷 통신은 NAT Gateway를 통해서만 가능합니다.
- **고가용성**: 서울 리전의 2개 가용 영역(AZ)에 걸쳐 Public/Private 서브넷을 모두 구성하여, 한쪽 AZ에 장애가 발생해도 서비스가 중단 없이 운영되도록 합니다.

## 4. 보안 그룹 상세 설계: Zero Trust 원칙 기반

보안 그룹은 '아무도 믿지 않고, 꼭 필요한 최소한의 접근만 허용한다'는 Zero Trust(혹은 최소 권한) 원칙에 따라 설계합니다. 모든 인바운드(Inbound) 트래픽은 기본적으로 차단되며, 아래 규칙에 명시된 트래픽만 허용됩니다.

### SG-1: Public-ALB-SG (외부 트래픽 관문)

**역할**: FANS 서비스의 유일한 공개 창구입니다. 인터넷 사용자의 웹 요청(HTTPS)을 받아들이는 역할을 합니다.

**설계 의의**: FANS의 모든 내부 인프라를 인터넷으로부터 보호하는 첫 번째 방화벽입니다. 오직 표준 웹 트래픽(HTTPS)만 허용하여 비정상적인 접근 시도를 원천적으로 차단합니다.

| 방향 | 포트 | 프로토콜 | 소스/대상 | 설명 |
|------|------|----------|-----------|------|
| 인바운드 | 443 | TCP | 0.0.0.0/0 (Anywhere) | 모든 사용자의 HTTPS 웹 요청 허용 |
| 아웃바운드 | 3000, 8000-8002 | TCP | SG-2: Fargate-Web-SG | 수신한 요청을 내부 웹 서비스로 전달 |

### SG-2: Fargate-Web-SG (웹 애플리케이션 계층)

**역할**: 사용자 요청을 직접 처리하는 Main API와 AI Service 컨테이너를 보호합니다.

**설계 의의**: 이 보안 그룹의 가장 중요한 규칙은 인바운드 소스가 **오직 SG-1 (ALB)**라는 점입니다. 이를 통해 인터넷에서 직접 API 서버로 접근하는 것을 완벽하게 차단하고, 반드시 정상적인 경로(ALB)를 통과한 트래픽만 애플리케이션에 도달하도록 보장합니다.

| 방향 | 포트 | 프로토콜 | 소스/대상 | 설명 |
|------|------|----------|-----------|------|
| 인바운드 | 3000, 8000-8002 | TCP | SG-1: Public-ALB-SG | ALB를 통한 요청만 허용 |
| 아웃바운드 | 5432 | TCP | SG-4: RDS-SG | 데이터베이스로의 통신 허용 |
| | 6379 | TCP | SG-5: ElastiCache-SG | 캐시로의 통신 허용 |

### SG-3: Fargate-Internal-SG (내부 작업 계층)

**역할**: 외부와 직접 통신할 필요가 없는 RSS/API 크롤러 컨테이너를 보호합니다.

**설계 의의**: 인바운드 규칙이 전혀 없습니다. 즉, ALB를 포함한 그 어떤 서비스도 크롤러를 직접 호출할 수 없습니다. 크롤러는 오직 스케줄러(EventBridge)에 의해 내부적으로만 실행되므로, 외부 공격에 노출될 위험이 원천적으로 차단된 가장 안전한 계층입니다.

| 방향 | 포트 | 프로토콜 | 소스/대상 | 설명 |
|------|------|----------|-----------|------|
| 인바운드 | - | - | - | 규칙 없음 (모든 인바운드 트래픽 차단) |
| 아웃바운드 | 5432 | TCP | SG-4: RDS-SG | 수집한 데이터를 DB에 저장하기 위한 통신 |
| | 443 | TCP | 0.0.0.0/0 (Internet) | 네이버 API 등 외부 뉴스 소스에 접근 (NAT Gateway 경유) |

### SG-4: RDS-SG (데이터베이스 계층)

**역할**: 서비스의 모든 데이터를 저장하는 PostgreSQL 데이터베이스를 보호합니다.

**설계 의의**: 오직 허가된 Fargate 애플리케이션(SG-2, SG-3)만이 DB 포트(5432)에 접근할 수 있습니다. 인터넷은 물론, ALB조차도 DB에 직접 접근하는 것이 불가능하여 데이터를 매우 안전하게 보호합니다.

| 방향 | 포트 | 프로토콜 | 소스/대상 | 설명 |
|------|------|----------|-----------|------|
| 인바운드 | 5432 | TCP | SG-2: Fargate-Web-SG<br>SG-3: Fargate-Internal-SG | 허가된 웹 서비스와 크롤러의 DB 접근만 허용 |

### SG-5: ElastiCache-SG (캐시 계층)

**역할**: Redis 캐시를 보호합니다.

**설계 의의**: RDS와 마찬가지로, 캐시가 필요한 웹 애플리케이션(SG-2)만이 접근할 수 있도록 제한합니다.

| 방향 | 포트 | 프로토콜 | 소스/대상 | 설명 |
|------|------|----------|-----------|------|
| 인바운드 | 6379 | TCP | SG-2: Fargate-Web-SG | 웹 서비스의 캐시 접근만 허용 |

## 5. 배포 및 확장 전략

### CI/CD 파이프라인

GitHub main 브랜치에 코드가 푸시되면, GitHub Actions 워크플로우가 자동으로 트리거됩니다. 워크플로우는 각 마이크로서비스의 Docker 이미지를 빌드하여 **Amazon ECR (Elastic Container Registry)**에 푸시합니다. 이미지 푸시가 완료되면, AWS CLI 명령을 통해 해당 ECS Service를 업데이트하여 새로운 버전의 컨테이너를 무중단 롤링 배포(Rolling Update) 방식으로 배포합니다.

### 오토 스케일링 (Auto Scaling)

Amazon CloudWatch를 통해 Main API와 AI 서비스의 CPU/메모리 사용률, 동시 요청 수 등의 지표를 실시간으로 모니터링합니다. 미리 설정된 임계치(예: CPU 사용률 70% 이상)를 초과하면, ECS Service Auto Scaling 정책이 자동으로 실행되어 Fargate Task(컨테이너) 수를 신속하게 늘려 트래픽을 분산 처리합니다. 트래픽이 감소하면 다시 Task 수를 줄여 비용을 최적화합니다.

## 6. 비용 구성 및 단계별 아키텍처 전략

프로젝트의 현재 단계와 목표에 맞춰 인프라를 유연하게 선택하고 확장할 수 있도록 3단계 비용 모델을 제시합니다.

### 1) 최소 비용 구성 (개발/테스트)

**목표**: 기능 구현 및 내부 테스트에 집중하며, 월 고정 비용을 최대한 낮추는 것.

**월 예상 비용**: $70 ~ $120

| 컴포넌트 | 상세 구성 | 월 예상 비용 | 특징 및 운영 고려사항 |
|-----------|-----------|--------------|------------------------|
| 💻 ECS Fargate | 6개 서비스, 최소 사양 (0.25vCPU/0.5GB), Single-AZ | ~$20 ~ $30 | 기능 테스트 가능. 트래픽이 조금만 몰려도 느려지거나 장애 발생 가능성이 있습니다. |
| 🗄️ RDS | db.t4g.micro Single-AZ | ~$15 | DB 장애 시 서비스가 중단되며 수동 복구가 필요합니다. 데이터 안정성을 보장하기 어렵습니다. |
| ⚡ ElastiCache | 미사용 | $0 | 모든 요청이 DB로 직접 전달되어 DB 부하가 높고, 반복 요청에 대한 응답 속도가 느립니다. |
| 🔗 네트워크 | ALB + NAT Gateway (Single-AZ) | ~$35 | 고정 비용의 대부분을 차지하지만, 서비스 구동을 위한 필수 요소입니다. |
| 📊 기타 | S3, CloudFront, CloudWatch 등 | ~$5 | 트래픽이 거의 없어 Free Tier 내에서 대부분 처리 가능합니다. |

### 2) 표준 구성 (정식 서비스 / Best Practice)

**목표**: 실제 사용자에게 안정적이고 확장 가능한 서비스를 제공하는 것.

**월 예상 비용**: $210 ~ $290

| 컴포넌트 | 상세 구성 | 월 예상 비용 | 특징 및 운영 고려사항 |
|-----------|-----------|--------------|------------------------|
| 💻 ECS Fargate | 6개 서비스, 평균 0.5vCPU/1GB, Auto-Scaling (최소 2개, Multi-AZ) | $120 ~ $160 | 트래픽에 따라 자동으로 확장/축소되며, 한쪽 데이터센터 장애에도 서비스가 중단되지 않습니다. |
| 🗄️ RDS | db.t3.small Multi-AZ | $35 ~ $45 | 주 DB 장애 시 수 초 내에 예비 DB로 자동 전환되어 서비스 안정성이 매우 높습니다. |
| ⚡ ElastiCache | cache.t3.small Multi-AZ | $25 ~ $35 | 캐시를 통해 빠른 응답 속도를 제공하고 DB 부하를 줄여 전체 시스템 성능을 향상시킵니다. |
| 🔗 네트워크 | ALB + NAT Gateway (Multi-AZ) | $15 ~ $25 | 네트워크 인프라 또한 이중화되어 안정성이 더욱 높아집니다. (ALB 비용은 트래픽에 따라 산정) |
| 📊 기타 | S3, CloudFront, CloudWatch 등 | $15 ~ $25 | 실제 사용자 트래픽 및 로그 발생량에 따른 비용입니다. |

### 3) 고성능 구성 (대규모 트래픽)

**목표**: 수십만 이상의 대규모 사용자에게 최고의 성능과 안정성을 제공하는 것.

**월 예상 비용**: $500 ~ $1,500+

| 컴포넌트 | 상세 구성 | 월 예상 비용 | 특징 및 운영 고려사항 |
|-----------|-----------|--------------|------------------------|
| 💻 ECS Fargate | 1vCPU/2GB 이상, 적극적인 Auto-Scaling, Spot 인스턴스 활용 | $200 ~ $400+ | 대규모 트래픽에도 쾌적한 성능을 유지하며, Spot 인스턴스로 비용을 최적화합니다. |
| 🗄️ RDS | Amazon Aurora 또는 RDS Read Replicas (읽기 전용 복제본) 추가 | $200 ~ $800+ | 뉴스 조회 같은 읽기 요청을 여러 DB로 분산시켜, 쓰기 DB의 부하를 최소화하고 병목을 해결합니다. |
| ⚡ ElastiCache | 클러스터 모드 사용 | $80 ~ $200+ | 캐시 데이터를 여러 서버에 분산하여 더 많은 데이터를 저장하고, 더 높은 처리량을 감당합니다. |
| 🔗 네트워크 | ALB + NAT Gateway (Multi-AZ) | $50 ~ $100+ | 대규모 트래픽 처리에 따른 비용 증가분입니다. |
| 🔐 보안 | AWS WAF (웹 방화벽) 추가 | $50+ | 정교한 웹 공격(SQL Injection, XSS 등)까지 차단하여 보안을 최고 수준으로 강화합니다. |

## 7. 마이그레이션 단계별 계획 (총 4주)

### Phase 1: 기반 인프라 구축 (1주차)

- **목표**: 모든 서비스가 실행될 네트워크 및 데이터베이스 환경 구축
- **작업**: Terraform을 이용한 VPC/Subnets/Security Groups 코드화, RDS/ElastiCache 클러스터 생성, ECR 리포지토리 생성, 데이터 마이그레이션

### Phase 2: 애플리케이션 컨테이너화 및 배포 (2주차)

- **목표**: 모든 마이크로서비스를 Fargate 환경에서 성공적으로 실행
- **작업**: Docker 이미지 최적화 및 ECR 푸시, ECS Cluster 및 Task Definition/Service 작성, ALB와 타겟 그룹 설정 및 연동, Auto Scaling 정책 구성

### Phase 3: CI/CD 파이프라인 자동화 (3주차)

- **목표**: 배포 프로세스 완전 자동화 및 모니터링 환경 구축
- **작업**: GitHub Actions 워크플로우 작성, CloudWatch 대시보드 및 알람 설정, 보안 그룹 및 IAM 역할 권한 최적화

### Phase 4: 최종 전환 및 최적화 (4주차)

- **목표**: 프론트엔드 배포 및 전체 시스템 안정화
- **작업**: S3 + CloudFront 프론트엔드 배포 및 DNS(Route 53) 전환, 부하 테스트 및 성능 튜닝, 백업 및 재해 복구 절차 수립 및 검증

## 8. 보안 강화 전략

| 보안 레이어 | 적용 기술 | 상세 내용 |
|-------------|-----------|-----------|
| Edge | CloudFront + AWS WAF | DDoS 공격 방어 및 악의적인 웹 요청(SQL Injection 등) 차단 |
| 네트워크 | VPC, Security Group | Private Subnet을 통한 핵심 자원 격리, 포트 레벨 접근 제어 |
| 애플리케이션 | ALB + IAM Roles | HTTPS 강제 적용(SSL/TLS), Fargate Task별 최소 권한 역할 부여 |
| 데이터 | RDS/ElastiCache Encryption | 전송 중/저장 시 데이터 암호화(Encryption at Rest/Transit) |
| 자격 증명 | AWS Secrets Manager | DB 패스워드, API 키 등 민감 정보를 안전하게 관리하고 동적으로 주입 |